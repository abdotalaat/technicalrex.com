<!DOCTYPE html>
<html class="no-js">
<head>
	<meta charset="utf-8">
	<title>Creating a Jersey App on Google App Engine | Technical Rex</title>
	<meta name="description" content="Today I started writing a web app that I hope will become a web-based version of a 2-player peg jumping game that I devised a few weeks ago. Inspiration for ...">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	<meta http-equiv="X-Frame-Options" content="sameorigin">

	<link rel="stylesheet" href="/css/main.css">

	<link rel="canonical" href="http://technicalrex.com/2014/08/11/creating-a-jersey-app-on-google-app-engine">
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
	<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic" rel="stylesheet" type="text/css">

	<!-- For IE 9 and below. ICO should be 32x32 pixels in size -->
<!--[if IE]><link rel="shortcut icon" href="/img/icons/favicon.ico"><![endif]-->

<!-- Touch Icons - iOS and Android 2.1+ 180x180 pixels in size. -->
<link rel="apple-touch-icon" href="/img/icons/apple-touch-icon.png">

<!-- Firefox, Chrome, Safari, IE 11+ and Opera. 196x196 pixels in size. -->
<link rel="icon" href="/img/icons/favicon.png">

</head>

<body>
    <div id="landscape">
        <header class="site-header">
	<div class="branding flow-nav">
		<h1 class="site-title">
			<a href="/">Technical Rex</a>
		</h1>
	</div>
	<nav class="site-nav flow-nav">
		<ul class="flow-nav">
			
			
			<li class="flow-nav">
				<a class="page-link" href="/about.html">About</a>
			</li>
			
			
			
			<li class="flow-nav">
				<a class="page-link" href="/apps.html">Apps</a>
			</li>
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			<li class="flow-nav">
				<a href="/feed.xml" title="">
					<i class="fa fa-fw fa-rss"></i>
				</a>
			</li>
		</ul>
	</nav>
</header>

        <div id="page-container">
            <div class="underlay">
    <div class="content">
        <article>
            <header class="post-header">
                <h1 class="title">Creating a Jersey App on Google App Engine</h1>
                <p class="about">
                    Posted  by Erik Gillespie
                    on August 11, 2014
                </p>
            </header>
            <section class="post-content"><p>Today I started writing a web app that I hope will become a web-based version of a 2-player peg jumping game that I devised a few weeks ago. Inspiration for this game goes to my 18 month old daughter and her desire to play with her peg-hammering toy at 2 o’clock in the morning. I’ve settled on calling the game Pegger.</p>

<div class="image-center">
    
    <img src="/img/posts/pegger/peggerinspiration.jpg" class="shadow" />
    
    Inspiration comes at a dark hour
</div>

<p>I have only dabbled with deploying to the cloud so I made it a goal to stand up a bare-bones web app and deploy it to <a href="https://appengine.google.com">Google App Engine</a>. And I do mean bare-bones, there won’t be any user interface for this exercise besides typing a URL into your address bar and hitting Enter.</p>

<p>Besides deploying to the cloud, I also decided to create a <a href="http://goo.gl/BFDKcs">RESTish API</a> to expose server-side functionality to the browser. For this project I’m going to attempt to use the latest versions of <a href="https://jersey.java.net/">Jersey</a> (2.11), <a href="https://github.com/FasterXML/jackson">Jackson</a> (2.4.1), and <a href="http://projects.spring.io/spring-framewrk/">Spring</a> (4.0.6).</p>

<p><em>Warning! In the steps below I have provided values specific to my project that must be unique in order to deploy successfully to Google App Engine. You will need to supply different values in order to follow this tutorial successfully.</em></p>

<h2 id="prereqs">Prereqs</h2>

<p>Java is my strongest programming language so it was the obvious choice for creating a web app. Not only that but Google App Engine provides a nice <a href="https://developers.google.com/appengine/docs/java/gettingstarted/introduction">tutorial</a> for creating a basic project using Java and Maven. I deviate enough from their tutorial that I will repeat any important steps below so you don’t have to follow the link unless you want to learn more about Java on GAE.</p>

<p>Before I could start writing any code I needed to install a JDK and Maven. Here are the versions I decided to use:</p>

<ul>
  <li><a href="http://www.oracle.com/technetwork/java/javase/downloads/index-jsp-138363.html">JDK 1.8.0_11</a></li>
  <li><a href="http://maven.apache.org/download.cgi">Maven 3.2.2</a></li>
</ul>

<p>Install the JDK and make sure your <code>JAVA_HOME</code> environment variable is properly set. Then install Maven and set your <code>M2_HOME</code> environment variable. It also helps to put both <code>${JAVA_HOME}/bin</code> and <code>${M2_HOME}/bin</code> in your <code>PATH</code>.</p>

<p>When this is all done you should be able to run the following commands to see that both programs are runnable and of the correct versions.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>mvn --version
<span class="nv">$ </span>java -version</code></pre></div>

<h2 id="create-a-gae-project">Create a GAE Project</h2>

<p>In order to use Google App Engine you need a Google account. If that account is tied to a Google Apps domain (which is the case for me), then you also need to make sure that your Google account has access to Google App Engine.</p>

<p>If you have a Google Apps account then do the following:</p>

<ol>
  <li>Login to Google Apps as an administrator for your domain.</li>
  <li>Find the <a href="https://admin.google.com/AdminHome#AppDetails:service=Google+App+Engine+Admin+Console">Google App Engine Console service</a>.</li>
  <li>Change the service status from “OFF” to “ON for everyone”.</li>
</ol>

<p>If you don’t have a Google Apps account or have completed the steps above then follow these steps to create a new GAE project:</p>

<ol>
  <li>Go to the <a href="https://console.developers.google.com">Google Developer Console</a>.</li>
  <li>Click “Create Project” and in the box that appears enter:
    <ul>
      <li>Project Name: Pegger</li>
      <li>Project ID: technicalrex-pegger-1</li>
    </ul>
  </li>
  <li>Jot down the Project ID. You will need it soon.</li>
</ol>

<p>You now have a GAE project that you can deploy to!</p>

<h2 id="create-a-java-project">Create a Java Project</h2>

<p>The recommended way to create a new GAE Java project is to use a Maven archetype. Follow the steps below to create a new project located in <code>~/projects/pegger</code>.</p>

<ol>
  <li><code>cd ~/projects</code></li>
  <li><code>mvn archetype:generate</code>
    <ul>
      <li>Choose <code>com.google.appengine.archetypes:appengine-skeleton-archetype</code> (Option 1 in my case)</li>
      <li>groupId: <code>com.technicalrex.webapp</code></li>
      <li>artifactId: <code>pegger</code></li>
      <li>version: <code>1.0-SNAPSHOT</code> (default)</li>
      <li>package: <code>com.technicalrex.webapp</code> (default)</li>
    </ul>
  </li>
  <li>Edit <code>pegger/pegger-ear/src/main/application/META-INF/appengine-application.xml</code> and replace the value “pegger” with “technicalrex-pegger-1”.</li>
  <li>Edit <code>pegger/pegger-war/src/main/webapp/WEB-INF/appengine-application.xml</code> and replace the value “pegger” with “technicalrex-pegger-1”.</li>
  <li>Edit <code>pegger/pom.xml</code> and update the <code>appengine.target.version</code> property to 1.9.8 (or whatever the latest version of the Google App Engine API is as you follow these steps).</li>
</ol>

<p>All of the steps above are standard for any GAE Java project that you will create. However, since GAE only runs on Java 7 right now and because I installed JDK 8 there is one more change to be made before we can get to the fun stuff.</p>

<p>Edit <code>pegger/pom.xml</code> and add the following plugin:</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="lineno"> 1</span> <span class="nt">&lt;plugin&gt;</span>
<span class="lineno"> 2</span>     <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
<span class="lineno"> 3</span>     <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
<span class="lineno"> 4</span>     <span class="nt">&lt;version&gt;</span>3.1<span class="nt">&lt;/version&gt;</span>
<span class="lineno"> 5</span>     <span class="nt">&lt;configuration&gt;</span>
<span class="lineno"> 6</span>         <span class="nt">&lt;source&gt;</span>1.7<span class="nt">&lt;/source&gt;</span>
<span class="lineno"> 7</span>         <span class="nt">&lt;target&gt;</span>1.7<span class="nt">&lt;/target&gt;</span>
<span class="lineno"> 8</span>         <span class="nt">&lt;encoding&gt;</span>UTF-8<span class="nt">&lt;/encoding&gt;</span>
<span class="lineno"> 9</span>     <span class="nt">&lt;/configuration&gt;</span>
<span class="lineno">10</span> <span class="nt">&lt;/plugin&gt;</span></code></pre></div>

<p>That’s it for the project creation. You can verify that all is well by running <code>mvn clean install</code> and confirming that the command completes successfully.</p>

<h2 id="maven-dependencies">Maven Dependencies</h2>

<p>Spring and Jersey have started providing <a href="http://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html#Dependency_Management">BOMs</a> (Bill of Materials) to reduce the number of Maven dependencies that have to be maintained in your POM file. Instead of having to introduce half a dozen or more dependencies, you simply specify the BOM artifact then add in additional dependencies that the BOM does not provide. In our case we will specify BOMs for Spring and Jersey. Then we will add one additional dependency for Spring and three additional dependencies for Jersey.</p>

<p>Jackson does not provide a BOM that I am aware of, so it still requires a handful of dependencies. However, Jackson doesn’t <em>require</em> any additional configuration besides including the appropriate JARs in your app so Jackson is still doing a lot to reduce the amount of required configuration. That being said, I will still add some Jackson configuration to demonstrate how it is done in case we want to change some default options and/or add support for third party serializers and deserializers.</p>

<p>To introduce these dependencies, edit <code>pegger/pom.xml</code> and make the following additions.</p>

<p>Define properties for each framework version:</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="lineno">1</span> <span class="nt">&lt;spring.version&gt;</span>4.0.6.RELEASE<span class="nt">&lt;/spring.version&gt;</span>
<span class="lineno">2</span> <span class="nt">&lt;jersey.version&gt;</span>2.11<span class="nt">&lt;/jersey.version&gt;</span>
<span class="lineno">3</span> <span class="nt">&lt;jackson.version&gt;</span>2.4.1<span class="nt">&lt;/jackson.version&gt;</span></code></pre></div>

<p>Import the Spring and Jersey BOMs:</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="lineno"> 1</span> <span class="nt">&lt;dependencyManagement&gt;</span>
<span class="lineno"> 2</span>     <span class="nt">&lt;dependencies&gt;</span>
<span class="lineno"> 3</span>         <span class="nt">&lt;dependency&gt;</span>
<span class="lineno"> 4</span>             <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
<span class="lineno"> 5</span>             <span class="nt">&lt;artifactId&gt;</span>spring-framework-bom<span class="nt">&lt;/artifactId&gt;</span>
<span class="lineno"> 6</span>             <span class="nt">&lt;version&gt;</span>${spring.version}<span class="nt">&lt;/version&gt;</span>
<span class="lineno"> 7</span>             <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
<span class="lineno"> 8</span>             <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
<span class="lineno"> 9</span>         <span class="nt">&lt;/dependency&gt;</span>
<span class="lineno">10</span>         <span class="nt">&lt;dependency&gt;</span>
<span class="lineno">11</span>             <span class="nt">&lt;groupId&gt;</span>org.glassfish.jersey<span class="nt">&lt;/groupId&gt;</span>
<span class="lineno">12</span>             <span class="nt">&lt;artifactId&gt;</span>jersey-bom<span class="nt">&lt;/artifactId&gt;</span>
<span class="lineno">13</span>             <span class="nt">&lt;version&gt;</span>${jersey.version}<span class="nt">&lt;/version&gt;</span>
<span class="lineno">14</span>             <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
<span class="lineno">15</span>             <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
<span class="lineno">16</span>         <span class="nt">&lt;/dependency&gt;</span>
<span class="lineno">17</span>     <span class="nt">&lt;/dependencies&gt;</span>
<span class="lineno">18</span> <span class="nt">&lt;/dependencyManagement&gt;</span></code></pre></div>

<p>Finally, add the remaining dependencies that aren’t covered by the BOMs. Put these in the top level dependencies block and not inside the dependency management block!</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="lineno"> 1</span> <span class="nt">&lt;dependency&gt;</span>
<span class="lineno"> 2</span>     <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
<span class="lineno"> 3</span>     <span class="nt">&lt;artifactId&gt;</span>spring-web<span class="nt">&lt;/artifactId&gt;</span>
<span class="lineno"> 4</span>     <span class="nt">&lt;version&gt;</span>${spring.version}<span class="nt">&lt;/version&gt;</span>
<span class="lineno"> 5</span> <span class="nt">&lt;/dependency&gt;</span>
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span> <span class="nt">&lt;dependency&gt;</span>
<span class="lineno"> 8</span>     <span class="nt">&lt;groupId&gt;</span>org.glassfish.jersey.containers<span class="nt">&lt;/groupId&gt;</span>
<span class="lineno"> 9</span>     <span class="nt">&lt;artifactId&gt;</span>jersey-container-servlet<span class="nt">&lt;/artifactId&gt;</span>
<span class="lineno">10</span> <span class="nt">&lt;/dependency&gt;</span>
<span class="lineno">11</span> <span class="nt">&lt;dependency&gt;</span>
<span class="lineno">12</span>     <span class="nt">&lt;groupId&gt;</span>org.glassfish.jersey.ext<span class="nt">&lt;/groupId&gt;</span>
<span class="lineno">13</span>     <span class="nt">&lt;artifactId&gt;</span>jersey-spring3<span class="nt">&lt;/artifactId&gt;</span>
<span class="lineno">14</span>     <span class="nt">&lt;version&gt;</span>${jersey.version}<span class="nt">&lt;/version&gt;</span>
<span class="lineno">15</span> <span class="nt">&lt;/dependency&gt;</span>
<span class="lineno">16</span> <span class="nt">&lt;dependency&gt;</span>
<span class="lineno">17</span>     <span class="nt">&lt;groupId&gt;</span>org.glassfish.jersey.media<span class="nt">&lt;/groupId&gt;</span>
<span class="lineno">18</span>     <span class="nt">&lt;artifactId&gt;</span>jersey-media-json-jackson<span class="nt">&lt;/artifactId&gt;</span>
<span class="lineno">19</span>     <span class="nt">&lt;version&gt;</span>${jersey.version}<span class="nt">&lt;/version&gt;</span>
<span class="lineno">20</span> <span class="nt">&lt;/dependency&gt;</span>
<span class="lineno">21</span> 
<span class="lineno">22</span> <span class="nt">&lt;dependency&gt;</span>
<span class="lineno">23</span>     <span class="nt">&lt;groupId&gt;</span>com.fasterxml.jackson.core<span class="nt">&lt;/groupId&gt;</span>
<span class="lineno">24</span>     <span class="nt">&lt;artifactId&gt;</span>jackson-annotations<span class="nt">&lt;/artifactId&gt;</span>
<span class="lineno">25</span>     <span class="nt">&lt;version&gt;</span>${jackson.version}<span class="nt">&lt;/version&gt;</span>
<span class="lineno">26</span> <span class="nt">&lt;/dependency&gt;</span>
<span class="lineno">27</span> <span class="nt">&lt;dependency&gt;</span>
<span class="lineno">28</span>     <span class="nt">&lt;groupId&gt;</span>com.fasterxml.jackson.core<span class="nt">&lt;/groupId&gt;</span>
<span class="lineno">29</span>     <span class="nt">&lt;artifactId&gt;</span>jackson-databind<span class="nt">&lt;/artifactId&gt;</span>
<span class="lineno">30</span>     <span class="nt">&lt;version&gt;</span>${jackson.version}<span class="nt">&lt;/version&gt;</span>
<span class="lineno">31</span> <span class="nt">&lt;/dependency&gt;</span>
<span class="lineno">32</span> <span class="nt">&lt;dependency&gt;</span>
<span class="lineno">33</span>     <span class="nt">&lt;groupId&gt;</span>com.fasterxml.jackson.jaxrs<span class="nt">&lt;/groupId&gt;</span>
<span class="lineno">34</span>     <span class="nt">&lt;artifactId&gt;</span>jackson-jaxrs-json-provider<span class="nt">&lt;/artifactId&gt;</span>
<span class="lineno">35</span>     <span class="nt">&lt;version&gt;</span>${jackson.version}<span class="nt">&lt;/version&gt;</span>
<span class="lineno">36</span> <span class="nt">&lt;/dependency&gt;</span></code></pre></div>

<h2 id="spring-configuration">Spring Configuration</h2>

<p>I have been wanting to try out Spring-sans-XML for a while so I decided to give it a shot today. I’m sticking with using annotations for most of the bean definitions, primarily for the convenience but also because I don’t really intend to write any code that might discourage me from coupling Spring to my classes.</p>

<p>The <code>web.xml</code> configuration is almost as simple as defining an XML file to configure Spring:</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="lineno"> 1</span> <span class="nt">&lt;context-param&gt;</span>
<span class="lineno"> 2</span>     <span class="nt">&lt;param-name&gt;</span>contextClass<span class="nt">&lt;/param-name&gt;</span>
<span class="lineno"> 3</span>     <span class="nt">&lt;param-value&gt;</span>
<span class="lineno"> 4</span>         org.springframework.web.context.support.AnnotationConfigWebApplicationContext
<span class="lineno"> 5</span>     <span class="nt">&lt;/param-value&gt;</span>
<span class="lineno"> 6</span> <span class="nt">&lt;/context-param&gt;</span>
<span class="lineno"> 7</span>    
<span class="lineno"> 8</span> <span class="nt">&lt;context-param&gt;</span>
<span class="lineno"> 9</span>     <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
<span class="lineno">10</span>     <span class="nt">&lt;param-value&gt;</span>
<span class="lineno">11</span>         com.technicalrex.webapp.pegger.internal.SpringConfig
<span class="lineno">12</span>     <span class="nt">&lt;/param-value&gt;</span>
<span class="lineno">13</span> <span class="nt">&lt;/context-param&gt;</span>
<span class="lineno">14</span>    
<span class="lineno">15</span> <span class="nt">&lt;listener&gt;</span>
<span class="lineno">16</span>     <span class="nt">&lt;listener-class&gt;</span>
<span class="lineno">17</span>         org.springframework.web.context.ContextLoaderListener
<span class="lineno">18</span>     <span class="nt">&lt;/listener-class&gt;</span>
<span class="lineno">19</span> <span class="nt">&lt;/listener&gt;</span></code></pre></div>

<p>You will see that the <code>contextConfigLocation</code> points to a class instead of an XML file. Go ahead and create that class. Here’s what it looks like:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="lineno">1</span> <span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">technicalrex</span><span class="o">.</span><span class="na">webapp</span><span class="o">.</span><span class="na">pegger</span><span class="o">.</span><span class="na">internal</span><span class="o">;</span>
<span class="lineno">2</span> 
<span class="lineno">3</span> <span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="lineno">4</span> <span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="lineno">5</span> 
<span class="lineno">6</span> <span class="nd">@Configuration</span>
<span class="lineno">7</span> <span class="nd">@ComponentScan</span><span class="o">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="s">&quot;com.technicalrex.webapp.pegger&quot;</span><span class="o">)</span>
<span class="lineno">8</span> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfig</span> <span class="o">{</span>
<span class="lineno">9</span> <span class="o">}</span></code></pre></div>

<p>Even with the package and import statements that class is way smaller than the equivalent XML. Furthermore, that’s all of the Spring config that we will need right now!</p>

<h2 id="jersey-configuration">Jersey Configuration</h2>

<p>Jersey’s configuration is similar to Spring’s in that we need to add some config to <code>web.xml</code> and then define a class to provide the rest.</p>

<p>First, add the following lines to <code>web.xml</code>:</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="lineno"> 1</span> <span class="nt">&lt;servlet&gt;</span>
<span class="lineno"> 2</span>     <span class="nt">&lt;servlet-name&gt;</span>jerseyServlet<span class="nt">&lt;/servlet-name&gt;</span>
<span class="lineno"> 3</span>     <span class="nt">&lt;servlet-class&gt;</span>
<span class="lineno"> 4</span>         org.glassfish.jersey.servlet.ServletContainer
<span class="lineno"> 5</span>     <span class="nt">&lt;/servlet-class&gt;</span>
<span class="lineno"> 6</span>     <span class="nt">&lt;init-param&gt;</span>
<span class="lineno"> 7</span>         <span class="nt">&lt;param-name&gt;</span>javax.ws.rs.Application<span class="nt">&lt;/param-name&gt;</span>
<span class="lineno"> 8</span>         <span class="nt">&lt;param-value&gt;</span>
<span class="lineno"> 9</span>             com.technicalrex.webapp.pegger.internal.JerseyConfig
<span class="lineno">10</span>         <span class="nt">&lt;/param-value&gt;</span>
<span class="lineno">11</span>     <span class="nt">&lt;/init-param&gt;</span>
<span class="lineno">12</span>     <span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
<span class="lineno">13</span> <span class="nt">&lt;/servlet&gt;</span>
<span class="lineno">14</span> <span class="nt">&lt;servlet-mapping&gt;</span>
<span class="lineno">15</span>     <span class="nt">&lt;servlet-name&gt;</span>jerseyServlet<span class="nt">&lt;/servlet-name&gt;</span>
<span class="lineno">16</span>     <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="lineno">17</span> <span class="nt">&lt;/servlet-mapping&gt;</span></code></pre></div>

<p>Second, create the class <code>JerseyConfig</code> and register <code>RequestContextFilter.class</code> so our JAX-RS resources can be injected with Spring beans:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="lineno"> 1</span> <span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">technicalrex</span><span class="o">.</span><span class="na">webapp</span><span class="o">.</span><span class="na">pegger</span><span class="o">.</span><span class="na">internal</span><span class="o">;</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="kn">import</span> <span class="nn">com.technicalrex.webapp.pegger.greetings.Greetings</span><span class="o">;</span>
<span class="lineno"> 4</span> <span class="kn">import</span> <span class="nn">org.glassfish.jersey.server.ResourceConfig</span><span class="o">;</span>
<span class="lineno"> 5</span> <span class="kn">import</span> <span class="nn">org.glassfish.jersey.server.spring.scope.RequestContextFilter</span><span class="o">;</span>
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">JerseyConfig</span> <span class="kd">extends</span> <span class="n">ResourceConfig</span> <span class="o">{</span>
<span class="lineno"> 8</span>     <span class="kd">public</span> <span class="nf">JerseyConfig</span><span class="o">()</span> <span class="o">{</span>
<span class="lineno"> 9</span>         <span class="c1">// Enable Spring DI</span>
<span class="lineno">10</span>         <span class="n">register</span><span class="o">(</span><span class="n">RequestContextFilter</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="lineno">11</span>     <span class="o">}</span>
<span class="lineno">12</span> <span class="o">}</span></code></pre></div>

<h2 id="jackson-configuration">Jackson Configuration</h2>

<p>As mentioned earlier in this article, Jackson doesn’t technically need any additional configuration but there are a couple of features enabled by default that I am not a huge fan of. In particular, <code>CAN_OVERRIDE_ACCESS_MODIFIERS</code> is nasty because it will allow incoming JSON to write to private fields regardless of whether there are public setters for them. This seems a little dangerous to me so let’s make sure it’s disabled.</p>

<p>Eventually I will want to configure some third-party serializers and deserializers. That configuration would also go in this class but for now let’s keep it simple. Here’s what the Jackson configuration provider looks like:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="lineno"> 1</span> <span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">technicalrex</span><span class="o">.</span><span class="na">webapp</span><span class="o">.</span><span class="na">pegger</span><span class="o">.</span><span class="na">internal</span><span class="o">;</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="kn">import</span> <span class="nn">com.fasterxml.jackson.databind.MapperFeature</span><span class="o">;</span>
<span class="lineno"> 4</span> <span class="kn">import</span> <span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="o">;</span>
<span class="lineno"> 5</span> 
<span class="lineno"> 6</span> <span class="kn">import</span> <span class="nn">javax.ws.rs.ext.ContextResolver</span><span class="o">;</span>
<span class="lineno"> 7</span> <span class="kn">import</span> <span class="nn">javax.ws.rs.ext.Provider</span><span class="o">;</span>
<span class="lineno"> 8</span> 
<span class="lineno"> 9</span> <span class="nd">@Provider</span>
<span class="lineno">10</span> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">JacksonObjectMapperConfig</span>
<span class="lineno">11</span>         <span class="kd">implements</span> <span class="n">ContextResolver</span><span class="o">&lt;</span><span class="n">ObjectMapper</span><span class="o">&gt;</span> <span class="o">{</span>
<span class="lineno">12</span> 
<span class="lineno">13</span>     <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">ObjectMapper</span> <span class="n">OBJECT_MAPPER</span>
<span class="lineno">14</span>         <span class="o">=</span> <span class="k">new</span> <span class="nf">ObjectMapper</span><span class="o">()</span>
<span class="lineno">15</span>         <span class="o">.</span><span class="na">disable</span><span class="o">(</span><span class="n">MapperFeature</span><span class="o">.</span><span class="na">AUTO_DETECT_CREATORS</span><span class="o">)</span>
<span class="lineno">16</span>         <span class="o">.</span><span class="na">disable</span><span class="o">(</span><span class="n">MapperFeature</span><span class="o">.</span><span class="na">CAN_OVERRIDE_ACCESS_MODIFIERS</span><span class="o">);</span>
<span class="lineno">17</span> 
<span class="lineno">18</span>     <span class="nd">@Override</span>
<span class="lineno">19</span>     <span class="kd">public</span> <span class="n">ObjectMapper</span> <span class="nf">getContext</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">aClass</span><span class="o">)</span> <span class="o">{</span>
<span class="lineno">20</span>         <span class="k">return</span> <span class="n">OBJECT_MAPPER</span><span class="o">;</span>
<span class="lineno">21</span>     <span class="o">}</span>
<span class="lineno">22</span> <span class="o">}</span></code></pre></div>

<p>Once you have written the <code>JacksonObjectMapperConfig</code> you will need to register it with Jersey:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="lineno"> 1</span> <span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">technicalrex</span><span class="o">.</span><span class="na">webapp</span><span class="o">.</span><span class="na">pegger</span><span class="o">.</span><span class="na">internal</span><span class="o">;</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="kn">import</span> <span class="nn">org.glassfish.jersey.server.ResourceConfig</span><span class="o">;</span>
<span class="lineno"> 4</span> <span class="kn">import</span> <span class="nn">org.glassfish.jersey.server.spring.scope.RequestContextFilter</span><span class="o">;</span>
<span class="lineno"> 5</span> 
<span class="lineno"> 6</span> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">JerseyConfig</span> <span class="kd">extends</span> <span class="n">ResourceConfig</span> <span class="o">{</span>
<span class="lineno"> 7</span>     <span class="kd">public</span> <span class="nf">JerseyConfig</span><span class="o">()</span> <span class="o">{</span>
<span class="lineno"> 8</span>         <span class="c1">// Enable Spring DI and Jackson configuration</span>
<span class="lineno"> 9</span>         <span class="n">register</span><span class="o">(</span><span class="n">RequestContextFilter</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="lineno">10</span>         <span class="n">register</span><span class="o">(</span><span class="n">JacksonObjectMapperConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="lineno">11</span>     <span class="o">}</span>
<span class="lineno">12</span> <span class="o">}</span></code></pre></div>

<h2 id="kick-the-tires">Kick the Tires</h2>

<p>Now that all of the configuration is in place we should make sure the three frameworks are all playing nicely with each other. I do this by defining a <code>/greetings</code> resource that calls a service injected by Spring that returns a list of greetings that Jackson will serialize into JSON.</p>

<p>First, create a “domain object” class named <code>Greeting</code> and slap a Jackson annotation on it:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="lineno"> 1</span> <span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">technicalrex</span><span class="o">.</span><span class="na">webapp</span><span class="o">.</span><span class="na">pegger</span><span class="o">.</span><span class="na">greetings</span><span class="o">;</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonValue</span><span class="o">;</span>
<span class="lineno"> 4</span> 
<span class="lineno"> 5</span> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Greeting</span> <span class="o">{</span>
<span class="lineno"> 6</span>     <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">text</span><span class="o">;</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span>     <span class="kd">public</span> <span class="nf">Greeting</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
<span class="lineno"> 9</span>         <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">;</span>
<span class="lineno">10</span>     <span class="o">}</span>
<span class="lineno">11</span> 
<span class="lineno">12</span>     <span class="nd">@JsonValue</span>
<span class="lineno">13</span>     <span class="kd">public</span> <span class="n">String</span> <span class="nf">getText</span><span class="o">()</span> <span class="o">{</span>
<span class="lineno">14</span>         <span class="k">return</span> <span class="n">text</span><span class="o">;</span>
<span class="lineno">15</span>     <span class="o">}</span>
<span class="lineno">16</span> <span class="o">}</span></code></pre></div>

<p>Second, write a service that will return a list of <code>Greeting</code>s and wire it up in Spring:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="lineno"> 1</span> <span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">technicalrex</span><span class="o">.</span><span class="na">webapp</span><span class="o">.</span><span class="na">pegger</span><span class="o">.</span><span class="na">greetings</span><span class="o">;</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="lineno"> 4</span> 
<span class="lineno"> 5</span> <span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span> <span class="nd">@Service</span>
<span class="lineno"> 8</span> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">GreetingService</span> <span class="o">{</span>
<span class="lineno"> 9</span>     <span class="kd">public</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Greeting</span><span class="o">&gt;</span> <span class="nf">getEnglishGreetings</span><span class="o">()</span> <span class="o">{</span>
<span class="lineno">10</span>         <span class="k">return</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
<span class="lineno">11</span>             <span class="k">new</span> <span class="nf">Greeting</span><span class="o">(</span><span class="s">&quot;Hi&quot;</span><span class="o">),</span>
<span class="lineno">12</span>             <span class="k">new</span> <span class="nf">Greeting</span><span class="o">(</span><span class="s">&quot;Hello&quot;</span><span class="o">),</span>
<span class="lineno">13</span>             <span class="k">new</span> <span class="nf">Greeting</span><span class="o">(</span><span class="s">&quot;Yo&quot;</span><span class="o">));</span>
<span class="lineno">14</span>     <span class="o">}</span>
<span class="lineno">15</span> <span class="o">}</span></code></pre></div>

<p>Finally, define a JAX-RS resource that will allow us to view those greetings in a web browser:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="lineno"> 1</span> <span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">technicalrex</span><span class="o">.</span><span class="na">webapp</span><span class="o">.</span><span class="na">pegger</span><span class="o">.</span><span class="na">greetings</span><span class="o">;</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="o">;</span>
<span class="lineno"> 4</span> <span class="kn">import</span> <span class="nn">javax.ws.rs.GET</span><span class="o">;</span>
<span class="lineno"> 5</span> <span class="kn">import</span> <span class="nn">javax.ws.rs.Path</span><span class="o">;</span>
<span class="lineno"> 6</span> <span class="kn">import</span> <span class="nn">javax.ws.rs.Produces</span><span class="o">;</span>
<span class="lineno"> 7</span> <span class="kn">import</span> <span class="nn">javax.ws.rs.core.MediaType</span><span class="o">;</span>
<span class="lineno"> 8</span> <span class="kn">import</span> <span class="nn">javax.ws.rs.core.Response</span><span class="o">;</span>
<span class="lineno"> 9</span> 
<span class="lineno">10</span> <span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/greetings&quot;</span><span class="o">)</span>
<span class="lineno">11</span> <span class="nd">@Produces</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
<span class="lineno">12</span> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Greetings</span> <span class="o">{</span>
<span class="lineno">13</span>     <span class="kd">private</span> <span class="kd">final</span> <span class="n">GreetingService</span> <span class="n">greetingService</span><span class="o">;</span>
<span class="lineno">14</span> 
<span class="lineno">15</span>     <span class="nd">@Inject</span>
<span class="lineno">16</span>     <span class="kd">public</span> <span class="nf">Greetings</span><span class="o">(</span><span class="n">GreetingService</span> <span class="n">greetingService</span><span class="o">)</span> <span class="o">{</span>
<span class="lineno">17</span>         <span class="k">this</span><span class="o">.</span><span class="na">greetingService</span> <span class="o">=</span> <span class="n">greetingService</span><span class="o">;</span>
<span class="lineno">18</span>     <span class="o">}</span>
<span class="lineno">19</span> 
<span class="lineno">20</span>     <span class="nd">@GET</span>
<span class="lineno">21</span>     <span class="kd">public</span> <span class="n">Response</span> <span class="nf">getGreetings</span><span class="o">()</span> <span class="o">{</span>
<span class="lineno">22</span>         <span class="k">return</span> <span class="n">Response</span>
<span class="lineno">23</span>             <span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="n">greetingService</span><span class="o">.</span><span class="na">getEnglishGreetings</span><span class="o">())</span>
<span class="lineno">24</span>             <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="lineno">25</span>     <span class="o">}</span>
<span class="lineno">26</span> <span class="o">}</span></code></pre></div>

<p>Then make sure to register the new resource in the Jersey config:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="lineno"> 1</span> <span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">technicalrex</span><span class="o">.</span><span class="na">webapp</span><span class="o">.</span><span class="na">pegger</span><span class="o">.</span><span class="na">internal</span><span class="o">;</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="kn">import</span> <span class="nn">com.technicalrex.webapp.pegger.greetings.Greetings</span><span class="o">;</span>
<span class="lineno"> 4</span> <span class="kn">import</span> <span class="nn">org.glassfish.jersey.server.ResourceConfig</span><span class="o">;</span>
<span class="lineno"> 5</span> <span class="kn">import</span> <span class="nn">org.glassfish.jersey.server.spring.scope.RequestContextFilter</span><span class="o">;</span>
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">JerseyConfig</span> <span class="kd">extends</span> <span class="n">ResourceConfig</span> <span class="o">{</span>
<span class="lineno"> 8</span>     <span class="kd">public</span> <span class="nf">JerseyConfig</span><span class="o">()</span> <span class="o">{</span>
<span class="lineno"> 9</span>         <span class="c1">// Enable Spring DI and Jackson configuration</span>
<span class="lineno">10</span>         <span class="n">register</span><span class="o">(</span><span class="n">RequestContextFilter</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="lineno">11</span>         <span class="n">register</span><span class="o">(</span><span class="n">JacksonObjectMapperConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="lineno">12</span> 
<span class="lineno">13</span>         <span class="c1">// Application resources</span>
<span class="lineno">14</span>         <span class="n">register</span><span class="o">(</span><span class="n">Greetings</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="lineno">15</span>     <span class="o">}</span>
<span class="lineno">16</span> <span class="o">}</span></code></pre></div>

<p>In order to test it all out you will have to build the project and run it on a local app engine server. Run these commands to do just that:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd</span> ~/projects/pegger
<span class="nv">$ </span>mvn clean install
<span class="nv">$ </span><span class="nb">cd </span>pegger-ear
<span class="nv">$ </span>mvn appengine:devserver</code></pre></div>

<p>Once the server is running (you will see the message “Dev App Server is now running”), navigate to <code>http://localhost:8080/greetings</code> in your browser. You should see the following text:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">[</span>
    <span class="s2">&quot;Hi&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Hello&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Yo&quot;</span>
<span class="p">]</span></code></pre></div>

<h2 id="deploy-to-google-app-engine">Deploy to Google App Engine</h2>

<p>If everything up to this point has worked then the next steps will be a piece of cake. We will build the project, upload it to Google App Engine, and then test that it is running correctly on Google’s servers.</p>

<p>Build the project and upload it to Google using the following commands. The first time you run the <code>mvn</code> command you will be kicked over to a web browser window where Google will present a token to you. Copy that token and paste it into your terminal window (there will be a prompt) and then press Enter to finish the upload.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd</span> ~/projects/pegger/pegger-ear
<span class="nv">$ </span>mvn appengine:update</code></pre></div>

<p>To test the app out on Google’s servers you will need to navigate to <code>https://technicalrex-pegger-1.appspot.com/greetings</code>. You should see the same JSON array of greetings that you were presented with when you ran the project locally.</p>

<p>That’s it, our initial setup is done!</p>

<h2 id="whats-next">What’s Next?</h2>

<p>Standing up a brand new project can be time consuming and tedious but hopefully this example can help save you some time and effort. With Spring, Jersey, and Jackson playing nicely together it will also be very easy to start introducing new resources and services.</p>

<p>For most web apps though, the work doesn’t end here. In the weeks to come I hope to build on this tutorial by covering the following topics:</p>

<ol>
  <li>Representing game state using a RESTish API and JSON.</li>
  <li>Putting a UI in place using AngularJS and Bootstrap.</li>
  <li>Introducing a NoSQL data source.</li>
  <li>Adding accounts and authentication.</li>
  <li>More?!</li>
</ol>

<p>Stay tuned!</p>
</section>
            <p class="signature"> - Erik</p>
        </article>
    </div>
</div>

        </div>
        <footer class="site-footer">
	<p class="text">Copyright © 2015 Technical Rex, Inc. Re-use with attribution encouraged. All other rights reserved.</p>
</footer>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-62666024-3', 'auto');
ga('send', 'pageview');
</script>



    </div>
    <img id="rex" src="/img/rex/rex-main.png"></img>
</body>
</html>
