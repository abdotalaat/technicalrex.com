<!DOCTYPE html>
<html class="no-js">
<head>
	<meta charset="utf-8">
	
	<title>A Simple Turn-Based Game Client Using Bootstrap and AngularJS | Technical Rex</title>
	<meta name="description" content="Having an HTTP API for a game is great but until players can visually interact with the game it really won't be much fun to play. Now I will demonstrate how ...">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	<meta http-equiv="X-Frame-Options" content="sameorigin">

	<link rel="stylesheet" href="/css/main.css">

	<link rel="canonical" href="http://technicalrex.com/2014/10/01/using-bootstrap-and-angularjs-for-a-simple-turn-based-game">
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
	<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic" rel="stylesheet" type="text/css">

	<!-- For IE 9 and below. ICO should be 32x32 pixels in size -->
<!--[if IE]><link rel="shortcut icon" href="/img/icons/favicon.ico"><![endif]-->

<!-- Touch Icons - iOS and Android 2.1+ 180x180 pixels in size. -->
<link rel="apple-touch-icon" href="/img/icons/apple-touch-icon.png">

<!-- Firefox, Chrome, Safari, IE 11+ and Opera. 196x196 pixels in size. -->
<link rel="icon" href="/img/icons/favicon.png">

	
<meta property="article:published_time" content="2014-10-01T00:00:00-04:00" />
<meta property="article:modified_time" content="2014-10-01T00:00:00-04:00" />
<meta property="og:type" content="article" />
<meta property="og:title" content="A Simple Turn-Based Game Client Using Bootstrap and AngularJS" />
<meta property="og:url" content="http://technicalrex.com/2014/10/01/using-bootstrap-and-angularjs-for-a-simple-turn-based-game" />
<meta property="og:description" content="Having an HTTP API for a game is great but until players can visually interact with the game it really won&#39;t be much fun to play. Now I will demonstrate how Bootstrap and AngularJS can be used ..." />
<meta property="og:site_name" content="Technical Rex" />
<meta property="og:locale" content="en_US" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@eriklgillespie" />
<meta name="twitter:creator" content="@eriklgillespie" />


</head>

<body>
  <div id="landscape">
    <header class="site-header">
	<div class="branding flow-nav">
		<h1 class="site-title">
			<a href="/">
				Technical Rex
			</a>
		</h1>
	</div>
	<nav class="site-nav flow-nav">
		<ul class="flow-nav">
			
			
			<li class="flow-nav">
				<a class="page-link" href="/about.html">About</a>
			</li>
			
			
			
			<li class="flow-nav">
				<a class="page-link" href="/apps.html">Apps</a>
			</li>
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			<li class="flow-nav">
				<a href="/feed.xml" title="">
					<i class="fa fa-fw fa-rss"></i>
				</a>
			</li>
		</ul>
	</nav>
</header>

    <div id="page-container">
      <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block;width:320px;height:50px"
     data-ad-client="ca-pub-5353438818816835"
     data-ad-slot="2993999908"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

      <div class="underlay">
    <div class="content">
        <article>
            <header class="post-header">
                <h1 class="title">A Simple Turn-Based Game Client Using Bootstrap and AngularJS</h1>
                <p class="about">
                    Posted  by Erik Gillespie
                    on October 1, 2014
                </p>
            </header>
            <section class="post-content"><p>Having an HTTP API for a game is great but until players can visually interact with the game it really won’t be much fun to play. Below I will demonstrate how <a href="http://getbootstrap.com">Bootstrap</a> and <a href="https://angularjs.org">AngularJS</a> can be used to quickly make a simple (but pretty) interactive user interface for the game. To keep things simple, the game will be played in hot-seat style (both players will take turns in the game using the same computer and browser session).</p>

<p>If you haven’t been following this tutorial series, the name of the game is Pegger. If you would like to brush up on the rules and/or skip straight to the code, check the project out on <a href="https://github.com/egillespie/pegger">GitHub</a>.</p>

<p>For those who just want to try the game out, you can <a href="https://technicalrex-pegger-1.appspot.com">Play Pegger Here</a>!</p>

<p>Before I dive into the code let me review what the API looks like. Pegger is a simple peg-jumping game that can be boiled down to the following HTTP operations:</p>

<ol>
  <li><code class="highlighter-rouge">POST /games</code><br />
 With no request parameters to create a new game. The response will contain the starting layout of the game.</li>
  <li><code class="highlighter-rouge">PUT /games/{gameId}/pegs/{pegId}</code><br />
 With JSON that represents the new location of a peg to move a peg to a new location. The response will either be an error explaining why the move was invalid or redirect you to the new state of the game.</li>
</ol>

<p>Like I said, it’s really simple. I hope it makes for a good basic intro to the basic features of AngularJS and to a lesser extent, Bootstrap.</p>

<h2 id="client-requirements">Client Requirements</h2>

<p>What does the client need to do? Obviously there needs to be a way to start a game and then move pegs around, but let me go through the exercise of enumerating some of the more specific tasks that the client should do:</p>

<ol>
  <li>Present a home page where players can find the rules and start a new game.</li>
  <li>Create a new game on the server and render the starting layout of the pegs.</li>
  <li>Allow a player to select a peg and move it to a new location.</li>
  <li>Display any helpful messages that the server might provide in response to a peg being moved.</li>
</ol>

<p>These criteria are still straight forward but they provide a good starting point for implementing a browser client.</p>

<p>Now it’s time to create that home page.</p>

<h2 id="introducing-bootstrap">Introducing Bootstrap</h2>

<p>Among other things, Bootstrap is a suite of CSS styles that take a lot of the grunt work out of creating a consistent looking web site. For developers it helps free us up to write code and content instead of having to mess around with styles and browser compatibility. For the most part I lack that web design knack so a framework such as Bootstrap is very appealing to me.</p>

<p>Bootstrap also has great documentation and good examples. While looking through the examples for some inspiration I came across the “jumbotron” component and a <a href="http://getbootstrap.com/examples/jumbotron-narrow/">narrow jumbotron example</a> that I thought might fit the needs of Pegger well. The jumbotron is basically a big box that is the focal point of your page.</p>

<p>To get things started I grabbed the source for the narrow jumbotron example and slapped it into <code class="highlighter-rouge">pegger-war/src/main/webapp/index.hml</code>. I then customized the HTML by doing the following:</p>

<ol>
  <li>Got rid of the header above the jumbotron so that the jumbotron would be the first and top-most component on the page.</li>
  <li>Replaced the titles of the two-column section below the jumbotron with links to the rules, this tutorial series, the source code on GitHub, and an about page. Put a brief description below each title.</li>
  <li>Updated the footer to have the correct year and my business name.</li>
  <li>Put a stylish title in the jumbotron along with a description and button to start a new game of Pegger.</li>
</ol>

<p>I got creative with the title and made it look like it was written over the top of pegs (pegs that I will be reusing when I write the game board UI). I did this by defining a general <code class="highlighter-rouge">peg</code> style class that draws the circle shape at an appropriate size and added classes for the red, green, and yellow pegs to render them as different colors. Then all I had to do was put a letter in the <code class="highlighter-rouge">span</code> for each peg and presto! I got a decent home page without having to create a single image.</p>

<p>The resulting <code class="highlighter-rouge">index.html</code> and styles (located in <code class="highlighter-rouge">css/app.css</code>) will look like the text below. Notice that for now I’m pulling in Bootstrap using an external CDN instead of including it directly in the project.</p>

<p><strong>index.html</strong></p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</pre></td><td class="code"><pre><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span> <span class="na">xmlns=</span><span class="s">"http://www.w3.org/1999/html"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"IE=edge"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"description"</span> <span class="na">content=</span><span class="s">"Pegger is a simple little two player peg jumping strategy game"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"author"</span> <span class="na">content=</span><span class="s">"Erik Gillespie erik.gillespie@technicalrex.com"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;title&gt;</span>Pegger<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"css/app.css"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"jumbotron"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"peg r"</span><span class="nt">&gt;</span>P<span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"peg g"</span><span class="nt">&gt;</span>E<span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"peg y"</span><span class="nt">&gt;</span>G<span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"peg g"</span><span class="nt">&gt;</span>G<span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"peg r"</span><span class="nt">&gt;</span>E<span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"peg y"</span><span class="nt">&gt;</span>R<span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"lead"</span><span class="nt">&gt;</span>Welcome to the home of Pegger, a simple little peg jumping strategy game for two! If you're a curious developer there is also source code and a tutorial series that you can peruse.<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;&lt;a</span> <span class="na">class=</span><span class="s">"btn btn-lg btn-primary"</span> <span class="na">href=</span><span class="s">"#todo"</span> <span class="na">role=</span><span class="s">"button"</span><span class="nt">&gt;</span>Play Pegger<span class="nt">&lt;/a&gt;&lt;/p&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row marketing"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-6"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h4&gt;&lt;a</span> <span class="na">href=</span><span class="s">"rules.html"</span><span class="nt">&gt;</span>Rules<span class="nt">&lt;/a&gt;&lt;/h4&gt;</span>
      <span class="nt">&lt;p&gt;</span>You could probably learn the rules by playing the game but here's a summary just in case.<span class="nt">&lt;/p&gt;</span>

      <span class="nt">&lt;h4&gt;&lt;a</span> <span class="na">href=</span><span class="s">"about.html"</span><span class="nt">&gt;</span>About<span class="nt">&lt;/a&gt;&lt;/h4&gt;</span>
      <span class="nt">&lt;p&gt;</span>Learn about the author of Pegger and how the game was inspired.<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-6"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h4&gt;&lt;a</span> <span class="na">href=</span><span class="s">"http://technicalrex.com/tag/pegger/?order=asc"</span><span class="nt">&gt;</span>Tutorial<span class="nt">&lt;/a&gt;&lt;/h4&gt;</span>
      <span class="nt">&lt;p&gt;</span>If you're a developer and want to read about how Pegger was made then read through this tutorial.<span class="nt">&lt;/p&gt;</span>

      <span class="nt">&lt;h4&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://github.com/egillespie/pegger"</span><span class="nt">&gt;</span>GitHub<span class="nt">&lt;/a&gt;&lt;/h4&gt;</span>
      <span class="nt">&lt;p&gt;</span>Another developer resource for those who just want to browse the Pegger source code, report bugs, or request new features.<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"footer"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p&gt;</span><span class="ni">&amp;copy;</span> Erik Gillespie. 2014<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p><strong>css/app.css (partial)</strong></p>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></td><td class="code"><pre><span class="c">/* --- Narrow Jumbotron Styles Go Here --- */</span>

<span class="nc">.peg</span> <span class="p">{</span>
    <span class="nl">display</span><span class="p">:</span> <span class="n">inline-block</span><span class="p">;</span>
    <span class="nl">width</span><span class="p">:</span> <span class="m">1.1em</span><span class="p">;</span>
    <span class="nl">height</span><span class="p">:</span> <span class="m">1.1em</span><span class="p">;</span>
    <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="m">#937e62</span><span class="p">;</span>
    <span class="nl">border-radius</span><span class="p">:</span> <span class="m">50%</span><span class="p">;</span>
    <span class="nl">background-color</span><span class="p">:</span> <span class="no">white</span><span class="p">;</span>
    <span class="nl">margin</span><span class="p">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="nl">color</span><span class="p">:</span> <span class="no">white</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.r</span> <span class="p">{</span>
    <span class="nl">background-color</span><span class="p">:</span> <span class="m">#d9534f</span><span class="p">;</span>
    <span class="nl">border-color</span><span class="p">:</span> <span class="m">#c9302c</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.g</span> <span class="p">{</span>
    <span class="nl">background-color</span><span class="p">:</span> <span class="m">#5cb85c</span><span class="p">;</span>
    <span class="nl">border-color</span><span class="p">:</span> <span class="m">#449d44</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.y</span> <span class="p">{</span>
    <span class="nl">background-color</span><span class="p">:</span> <span class="m">#fef049</span><span class="p">;</span>
    <span class="nl">border-color</span><span class="p">:</span> <span class="m">#ffd663</span><span class="p">;</span>
<span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>The resulting page will look like this:</p>

<div class="image-center">
    
    <img src="/img/posts/pegger/peggerfrontpage.png" class="shadow" />
    
    Pegger Home Page
</div>

<h2 id="introducing-angularjs">Introducing AngularJS</h2>

<p>AngularJS is a JavaScript framework developed by some of the folks at Google. It offers a lot of functionality that makes creating a rich, interactive web site a pleasure, even for someone who doesn’t tend to call himself a UI developer.  I’ll use a number of popular AngularJS features for Pegger such as view templates, event handling, dependency management, AJAX requests, navigation/routing, and scope management.</p>

<p>To start this off I update <code class="highlighter-rouge">index.html</code> to include minified versions of <code class="highlighter-rouge">angular.js</code> and <code class="highlighter-rouge">angular-route.js</code> in the `` tag. I also include some standard JavaScript files that I will use to organize the Angular code: <code class="highlighter-rouge">app.js</code>, <code class="highlighter-rouge">controllers.js</code>, and <code class="highlighter-rouge">services.js</code>.</p>

<p>In order to properly introduce Angular to the web app I also supply <code class="highlighter-rouge">ng-app</code> and <code class="highlighter-rouge">ng-controller</code> directives. I will also change the Bootstrap jumbotron to a placeholder for the Angular view templates. By default the jumbotron will still show the button to start a new game, but when this button is clicked then the Pegger board will be rendered inside the jumbotron.</p>

<p>Here’s what the pertinent parts of <code class="highlighter-rouge">index.html</code> look like now:</p>

<p><strong>index.html (partial)</strong></p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre><span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span> <span class="na">xmlns=</span><span class="s">"http://www.w3.org/1999/html"</span> <span class="na">ng-app=</span><span class="s">"peggerApp"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="c">&lt;!-- meta, title, css, etc. --&gt;</span>
  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0-rc.3/angular.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0-rc.3/angular-route.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"js/app.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"js/controllers.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"js/services.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body</span> <span class="na">ng-controller=</span><span class="s">"PeggerCtrl"</span><span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"jumbotron"</span> <span class="na">ng-view</span><span class="nt">&gt;&lt;/div&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>The default content of the jumbotron got moved into <code class="highlighter-rouge">partials/home.html</code>:</p>

<p><strong>partials/home.html</strong></p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre><span class="nt">&lt;h1&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"peg r"</span><span class="nt">&gt;</span>P<span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"peg g"</span><span class="nt">&gt;</span>E<span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"peg y"</span><span class="nt">&gt;</span>G<span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"peg g"</span><span class="nt">&gt;</span>G<span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"peg r"</span><span class="nt">&gt;</span>E<span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"peg y"</span><span class="nt">&gt;</span>R<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"lead"</span><span class="nt">&gt;</span>Welcome to the home of Pegger, a simple little peg jumping strategy game for two! If you're a curious developer there is also source code and a tutorial series that you can peruse.<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;p&gt;&lt;a</span> <span class="na">class=</span><span class="s">"btn btn-lg btn-primary"</span> <span class="na">href=</span><span class="s">"#/play"</span> <span class="na">role=</span><span class="s">"button"</span><span class="nt">&gt;</span>Play Pegger<span class="nt">&lt;/a&gt;&lt;/p&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h2 id="the-app-controller-and-service">The App, Controller, and Service</h2>

<p>At the highest level of the client portion of the web app I need to define an Angular module that will collect all of the other services, controllers, and configuration into a central location. Typically this module is called the application or app.</p>

<p>The Pegger app will be relatively small since it will only need to group up the controller and service as well as define a default template for our view and the alternate “board” view for when a user is actually playing a game of Pegger.</p>

<p><strong>js/app.js</strong></p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">peggerApp</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'peggerApp'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'ngRoute'</span><span class="p">,</span> <span class="s1">'peggerControllers'</span><span class="p">,</span> <span class="s1">'peggerServices'</span><span class="p">]);</span>

<span class="nx">peggerApp</span><span class="p">.</span><span class="nx">config</span><span class="p">([</span><span class="s1">'$routeProvider'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$routeProvider</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$routeProvider</span>
            <span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="s1">'/play'</span><span class="p">,</span> <span class="p">{</span>
                <span class="na">templateUrl</span><span class="p">:</span> <span class="s1">'partials/board.html'</span><span class="p">,</span>
                <span class="na">controller</span><span class="p">:</span> <span class="s1">'PeggerCtrl'</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="nx">otherwise</span><span class="p">({</span>
                <span class="na">templateUrl</span><span class="p">:</span> <span class="s1">'partials/home.html'</span>
            <span class="p">});</span>
<span class="p">}]);</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>The “/play” route that I have defined corresponds to the anchor tag in <code class="highlighter-rouge">home.html</code> that links to “#/play”. When a user clicks the button the content of the jumbotron will be replaced with the content of <code class="highlighter-rouge">partials/board.html</code> and the functionality for that view will be managed by the Pegger controller. I will show you the content of <code class="highlighter-rouge">board.html</code> after the controller is defined, since it relies heavily on the attributes and functions made available in that controller’s scope.</p>

<p>The service is the next easiest piece to construct. This service parameterizes and calls the HTTP API that I created in an <a href="/2014/09/15/pegger-as-a-component-based-api">earlier article</a> of this tutorial series. Besides the parameters to the API, the service also expects a caller to provide custom success and error handlers for the HTTP response.</p>

<p>I chose to use <code class="highlighter-rouge">$http</code> instead of <code class="highlighter-rouge">$resource</code> to demonstrate the hierarchical structure of the API. I will probably switch to <code class="highlighter-rouge">$resource</code> at some point in the future since it is easier to read and offers some nice higher level conveniences such as parameterized URLs.</p>

<p><strong>js/services.js</strong></p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">peggerServices</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'peggerServices'</span><span class="p">,</span> <span class="p">[]);</span>

<span class="nx">peggerServices</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">'games'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$http'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$http</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">post</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">success</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">$http</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/games'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">success</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
      <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">error</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">},</span>
    <span class="na">byId</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">gameId</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="na">pegs</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">byId</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pegId</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">{</span>
              <span class="na">put</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">success</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">$http</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s1">'/games/'</span><span class="o">+</span><span class="nx">gameId</span><span class="o">+</span><span class="s1">'/pegs/'</span><span class="o">+</span><span class="nx">pegId</span><span class="p">,</span> <span class="nx">data</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                  <span class="nx">success</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
                <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                  <span class="nx">error</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
                <span class="p">});</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}]);</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>This defines a service that has the following accessible functions:</p>

<ol>
  <li><code class="highlighter-rouge">games.post([success], [error])</code> - Creates a new game.</li>
  <li><code class="highlighter-rouge">games.byId({gameId}).pegs.byId({pegId}).put([data], [success], [error])</code> - Attempts to move a peg.</li>
</ol>

<p>The last piece of JavaScript that I need to put in place is the controller. Controllers are where all of the hard work gets done in an Angular app. In the case of Pegger (a single controller app) the controller is responsible for maintaining the state of the game board, managing interactions with the game, calling the server, and translating the server responses to something  that can be presented to the user. Even for a small app such as Pegger this results in a decent amount of code.</p>

<p><strong>js/controllers.js</strong></p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">peggerControllers</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'peggerControllers'</span><span class="p">,</span> <span class="p">[]);</span>

<span class="nx">peggerControllers</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">'PeggerCtrl'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$scope'</span><span class="p">,</span> <span class="s1">'games'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">games</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">selectedPeg</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

  <span class="nx">games</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$scope</span><span class="p">.</span><span class="nx">game</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
    <span class="nx">$scope</span><span class="p">.</span><span class="nx">messageKey</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
  <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$scope</span><span class="p">.</span><span class="nx">messageKey</span> <span class="o">=</span> <span class="s1">'games.post.error'</span><span class="p">;</span>
  <span class="p">});</span>

  <span class="nx">findPeg</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">pegs</span> <span class="o">=</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">pegs</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">pegs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pegs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">position</span><span class="p">.</span><span class="nx">row</span> <span class="o">==</span> <span class="nx">row</span> <span class="o">&amp;&amp;</span> <span class="nx">pegs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">position</span><span class="p">.</span><span class="nx">column</span> <span class="o">==</span> <span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">pegs</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="nx">selectPeg</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$scope</span><span class="p">.</span><span class="nx">selectedPeg</span> <span class="o">=</span> <span class="nx">findPeg</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="nx">column</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="nx">$scope</span><span class="p">.</span><span class="nx">pegStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">style</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">peg</span> <span class="o">=</span> <span class="nx">findPeg</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="nx">column</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">peg</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">style</span> <span class="o">+=</span> <span class="nx">peg</span><span class="p">.</span><span class="nx">type</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$scope</span><span class="p">.</span><span class="nx">selectedPeg</span> <span class="o">&amp;&amp;</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">selectedPeg</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">row</span> <span class="o">==</span> <span class="nx">row</span>
        <span class="o">&amp;&amp;</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">selectedPeg</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">column</span> <span class="o">==</span> <span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">style</span> <span class="o">+=</span> <span class="s2">" selected"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">style</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="nx">$scope</span><span class="p">.</span><span class="nx">pegClicked</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$scope</span><span class="p">.</span><span class="nx">selectedPeg</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">peg</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">$scope</span><span class="p">.</span><span class="nx">selectedPeg</span><span class="p">));</span>
      <span class="nx">peg</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">row</span> <span class="o">=</span> <span class="nx">row</span><span class="p">;</span>
      <span class="nx">peg</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">column</span> <span class="o">=</span> <span class="nx">column</span><span class="p">;</span>
      <span class="nx">games</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="nx">$scope</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">gameId</span><span class="p">).</span><span class="nx">pegs</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="nx">peg</span><span class="p">.</span><span class="nx">pegId</span><span class="p">).</span><span class="nx">put</span><span class="p">(</span><span class="nx">peg</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$scope</span><span class="p">.</span><span class="nx">selectedPeg</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="nx">$scope</span><span class="p">.</span><span class="nx">game</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
        <span class="nx">$scope</span><span class="p">.</span><span class="nx">messageKey</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
        <span class="nx">$scope</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
      <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$scope</span><span class="p">.</span><span class="nx">selectedPeg</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">case</span> <span class="mi">400</span><span class="err">:</span>
            <span class="nx">$scope</span><span class="p">.</span><span class="nx">messageKey</span> <span class="o">=</span> <span class="s1">'pegs.notSelected.error'</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mi">404</span><span class="err">:</span>
            <span class="nx">$scope</span><span class="p">.</span><span class="nx">messageKey</span> <span class="o">=</span> <span class="s1">'games.notFound.error'</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mi">409</span><span class="err">:</span>
            <span class="nx">$scope</span><span class="p">.</span><span class="nx">messageKey</span> <span class="o">=</span> <span class="s1">'pegs.conflict.error'</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mi">422</span><span class="err">:</span>
            <span class="nx">$scope</span><span class="p">.</span><span class="nx">messageKey</span> <span class="o">=</span> <span class="s1">'pegs.user.error'</span><span class="p">;</span>
            <span class="nx">$scope</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="nl">default</span><span class="p">:</span>
            <span class="nx">$scope</span><span class="p">.</span><span class="nx">messageKey</span> <span class="o">=</span> <span class="s1">'pegs.put.error'</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">selectPeg</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="nx">column</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">}]);</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Here are the starting line numbers and descriptions of some of the more important pieces of this controller:</p>

<ul>
  <li><strong>3</strong> - Include the <code class="highlighter-rouge">games</code> service as a dependency.</li>
  <li><strong>6</strong> - Create a new game as soon as the controller is invoked and put the initial game state in scope.</li>
  <li><strong>10</strong> - Expose a function to determine the style classes for a given peg. The type of peg and whether or not the peg are selected both affect the style applied to the peg.</li>
  <li><strong>41</strong> - If a peg is clicked/tapped and another peg is already selected then instruct the server to move the peg. Update the game state if the move was successful (including the display of a “Game Over” message) or print an error message to the user if not.</li>
  <li><strong>71</strong> - If a peg is clicked/tapped and another peg is not already selected then select that peg.</li>
</ul>

<h2 id="draw-the-board">Draw the Board</h2>

<p>The final piece of this puzzle is the rendering of the game board. Now that I have a controller with some functionality exposed, this becomes very easy.</p>

<p>Basically all I have to do is display two rows of four pegs and associate each of the pegs with the style and action that should be invoked when that peg is clicked. The magic of Angular is that any time the state of the game changes, this template will automatically be updated to reflect the current representation of the game.</p>

<p>The larger portion of this template is dedicated to interpreting errors and displaying user-friendly messages for all of the different “bad move” scenarios that must be supported.</p>

<p><strong>partials/board.html</strong></p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></td><td class="code"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"board"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"peg "</span> <span class="na">ng-click=</span><span class="s">"pegClicked(1,1)"</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"peg "</span> <span class="na">ng-click=</span><span class="s">"pegClicked(1,2)"</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"peg "</span> <span class="na">ng-click=</span><span class="s">"pegClicked(1,3)"</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"peg "</span> <span class="na">ng-click=</span><span class="s">"pegClicked(1,4)"</span><span class="nt">&gt;&lt;/span&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"peg "</span> <span class="na">ng-click=</span><span class="s">"pegClicked(2,1)"</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"peg "</span> <span class="na">ng-click=</span><span class="s">"pegClicked(2,2)"</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"peg "</span> <span class="na">ng-click=</span><span class="s">"pegClicked(2,3)"</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"peg "</span> <span class="na">ng-click=</span><span class="s">"pegClicked(2,4)"</span><span class="nt">&gt;&lt;/span&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-danger"</span> <span class="na">role=</span><span class="s">"alert"</span> <span class="na">ng-show=</span><span class="s">"messageKey == 'games.post.error'"</span><span class="nt">&gt;</span>
  Oh snap! Something went wrong creating your game. <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"javascript:location.reload()"</span><span class="nt">&gt;</span>Try again?<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-danger"</span> <span class="na">role=</span><span class="s">"alert"</span> <span class="na">ng-show=</span><span class="s">"messageKey == 'pegs.notSelected.error'"</span><span class="nt">&gt;</span>
  You have to select a peg in order to move a peg.
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-warning"</span> <span class="na">role=</span><span class="s">"alert"</span> <span class="na">ng-show=</span><span class="s">"messageKey == 'pegs.user.error'"</span><span class="nt">&gt;</span>
  
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-danger"</span> <span class="na">role=</span><span class="s">"alert"</span> <span class="na">ng-show=</span><span class="s">"messageKey == 'games.notFound.error'"</span><span class="nt">&gt;</span>
  Woops! That game doesn't exist any more. Would you like to create a <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"javascript:location.reload()"</span><span class="nt">&gt;</span>new game?<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-danger"</span> <span class="na">role=</span><span class="s">"alert"</span> <span class="na">ng-show=</span><span class="s">"messageKey == 'pegs.conflict.error'"</span><span class="nt">&gt;</span>
  You can't move a different peg than what is selected.
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-danger"</span> <span class="na">role=</span><span class="s">"alert"</span> <span class="na">ng-show=</span><span class="s">"messageKey == 'pegs.put.error'"</span><span class="nt">&gt;</span>
  Gremlins got into your game. They may have broken your game permanently but try taking another turn just in case this is a false alarm.
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-info"</span> <span class="na">role=</span><span class="s">"alert"</span> <span class="na">ng-show=</span><span class="s">"game.gameOver"</span><span class="nt">&gt;</span>
  Game Over! <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"javascript:location.reload()"</span><span class="nt">&gt;</span>Try again?<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/div&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h2 id="server-side-changes">Server Side Changes</h2>

<p>Before I can call the first iteration of the Pegger UI complete there are a couple of server side changes that must be made.</p>

<p>The first is expected and easy to fix. I have to add <code class="highlighter-rouge">index.html</code> to the welcome file list in the project’s <code class="highlighter-rouge">web.xml</code> so users can leave off the “/index.html” from the path in their address bar when typing the URL.</p>

<p><strong>web.xml (partial)</strong></p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="nt">&lt;web-app&gt;</span>
  ...
  <span class="nt">&lt;welcome-file-list&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>index.html<span class="nt">&lt;/welcome-file&gt;</span>
  <span class="nt">&lt;/welcome-file-list&gt;</span>
<span class="nt">&lt;/web-app&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>The other change was <em>not</em> to expected but fortunately has a <a href="http://stackoverflow.com/questions/25875505/gae-j-changes-content-type-from-json-to-html-when-the-status-code-is-4xx">ridiculously easy fix</a>.</p>

<p>By default, Jersey hands off the handling of HTTP errors to the servlet container when it is done. Unfortunately, Google App Engine’s dev and production servers do not handle those responses in the same way!</p>

<p>In dev, the server uses Jersey’s response. In production though, the response is overwritten with a generic (and ugly) HTML error page. This causes the error handling in the Pegger controller to totally break and draw an empty <code class="highlighter-rouge">&lt;div&gt;</code> below the board whenever the user makes an invalid move… but only in production. Dev works fine.</p>

<p>The solution is to <a href="https://jersey.java.net/documentation/latest/appendix-properties.html#appendix-properties-server">enable a feature in Jersey</a> that post-processes the response and leads to the response entity always being retained. This setting can be enabled in <code class="highlighter-rouge">web.xml</code> like so:</p>

<p><strong>web.xml (partial)</strong></p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre></td><td class="code"><pre><span class="nt">&lt;web-app&gt;</span>
  ...
  <span class="nt">&lt;servlet&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>jerseyServlet<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="nt">&lt;servlet-class&gt;</span>org.glassfish.jersey.servlet.ServletContainer<span class="nt">&lt;/servlet-class&gt;</span>
    <span class="nt">&lt;init-param&gt;</span>
      <span class="nt">&lt;param-name&gt;</span>javax.ws.rs.Application<span class="nt">&lt;/param-name&gt;</span>
      <span class="nt">&lt;param-value&gt;</span>com.technicalrex.webapp.pegger.internal.JerseyConfig<span class="nt">&lt;/param-value&gt;</span>
    <span class="nt">&lt;/init-param&gt;</span>
    <span class="nt">&lt;init-param&gt;</span>
      <span class="nt">&lt;param-name&gt;</span>jersey.config.server.response.setStatusOverSendError<span class="nt">&lt;/param-name&gt;</span>
      <span class="nt">&lt;param-value&gt;</span>true<span class="nt">&lt;/param-value&gt;</span>
    <span class="nt">&lt;/init-param&gt;</span>
    <span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
  <span class="nt">&lt;/servlet&gt;</span>
  ...
<span class="nt">&lt;/web-app&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h2 id="whats-next">What’s Next?</h2>

<p>I’m not really a UI developer but I was able to implement all of the client side changes detailed above in six or so hours. I’m pretty pleased with the results but I think there are still a few tweaks to be made.</p>

<p>Here are some things I would eventually like to try out and explain in a follow-up tutorial:</p>

<ol>
  <li>Get rid of the <code class="highlighter-rouge">location.reload()</code> calls by exposing the initialization of the controller.</li>
  <li>Create a custom directive for rendering pegs. It was fairly tedious to hand type each one and would be an interesting exercise.</li>
  <li>Add a transition effect when a user first clicks the “Play Pegger” button. Perhaps slide the current view out and the new one in.</li>
  <li>Introduce a wait indicator or icon when an action is performed so the user knows that their click or tap registered and the server is doing work.</li>
  <li>Add logic to the client to allow deselecting a peg.</li>
  <li>Refactor the <code class="highlighter-rouge">games</code> service to use <code class="highlighter-rouge">$resource</code> instead of <code class="highlighter-rouge">$http</code>.</li>
  <li>Get a real UI developer’s feedback and implement their suggestions.</li>
</ol>

<p>Thanks for reading and stay tuned for my next article!</p>
</section>
            <p class="signature"> - Erik</p>
        </article>
    </div>
</div>

    </div>
    <footer class="site-footer">
	<p class="text">Copyright &copy; 2016 Erik Gillespie. Re-use with attribution encouraged. All other rights reserved.</p>
</footer>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-62666024-3', 'auto');
ga('send', 'pageview');
</script>



  </div>
  <img id="rex" src="/img/rex/rex-main.png"></img>
  <script type="text/javascript" src="/js/retarget-links.js"></script>
</body>
</html>
