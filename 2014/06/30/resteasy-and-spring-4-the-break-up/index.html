<!DOCTYPE html>
<html class="no-js">
<head>
	<meta charset="utf-8">
	<title>RestEasy and Spring 4 - The Break Up | Technical Rex</title>
	<meta name="description" content="I have created enough projects from scratch that use Spring and RestEasy that I can crank out all of the code and XML by hand. That's what I thought anyway, ...">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	<meta http-equiv="X-Frame-Options" content="sameorigin">

	<link rel="stylesheet" href="/css/main.css">

	<link rel="canonical" href="http://technicalrex.com/2014/06/30/resteasy-and-spring-4-the-break-up">
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
	<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic" rel="stylesheet" type="text/css">

	<!-- For IE 9 and below. ICO should be 32x32 pixels in size -->
<!--[if IE]><link rel="shortcut icon" href="/img/icons/favicon.ico"><![endif]-->

<!-- Touch Icons - iOS and Android 2.1+ 180x180 pixels in size. -->
<link rel="apple-touch-icon" href="/img/icons/apple-touch-icon.png">

<!-- Firefox, Chrome, Safari, IE 11+ and Opera. 196x196 pixels in size. -->
<link rel="icon" href="/img/icons/favicon.png">

	<meta property="article:published_time" content="2014-06-30T00:00:00-04:00" />
<meta property="article:modified_time" content="2014-06-30T00:00:00-04:00" />
<meta property="og:type" content="article" />
<meta property="og:title" content="RestEasy and Spring 4 - The Break Up" />
<meta property="og:url" content="http://technicalrex.com/2014/06/30/resteasy-and-spring-4-the-break-up" />
<meta property="og:description" content="I have created enough projects from scratch that use Spring and RestEasy that I can crank out all of the code and XML by hand. That&#39;s what I thought anyway, until I decided to try out Spring 4 ..." />
<meta property="og:site_name" content="Technical Rex" />
<meta property="og:locale" content="en_US" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@eriklgillespie" />
<meta name="twitter:creator" content="@eriklgillespie" />


</head>

<body>
    <div id="landscape">
        <header class="site-header">
	<div class="branding flow-nav">
		<h1 class="site-title">
			<a href="/">
				<img class="favicon" src="/img/icons/favicon.png"/>
				Technical Rex
			</a>
		</h1>
	</div>
	<nav class="site-nav flow-nav">
		<ul class="flow-nav">
			
			
			<li class="flow-nav">
				<a class="page-link" href="/about.html">About</a>
			</li>
			
			
			
			<li class="flow-nav">
				<a class="page-link" href="/apps.html">Apps</a>
			</li>
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			<li class="flow-nav">
				<a href="/feed.xml" title="">
					<i class="fa fa-fw fa-rss"></i>
				</a>
			</li>
		</ul>
	</nav>
</header>

        <div id="page-container">
            <div class="underlay">
    <div class="content">
        <article>
            <header class="post-header">
                <h1 class="title">RestEasy and Spring 4:<br/>The Break Up</h1>
                <p class="about">
                    Posted  by Erik Gillespie
                    on June 30, 2014
                </p>
            </header>
            <section class="post-content"><p><strong>Edit:</strong> <em>The bug discussed in this article has been addressed in spring-resteasy 3.0.9.Final. Read through though! The intent of this article is to demonstrate why it is important to use <code>@Override</code> to avoid such bugs.</em></p>

<p>I have created enough projects from scratch that use <a href="http://projects.spring.io/spring-framework/">Spring</a> and <a href="http://resteasy.jboss.org">RestEasy</a> that I can crank out all of the code and XML by hand. That’s what I thought anyway, until I decided to try out Spring 4 in one of these new projects.</p>

<p>The typical steps I go through to create a new project with Spring and RestEasy are pretty straight forward:</p>

<ol>
  <li>Add Maven dependencies for RestEasy, Spring, and RestEasy-Spring integration.</li>
  <li>Register the RestEasy dispatcher filter, bootstrap listener, and SpringContextLoaderListener provided by the RestEasy-Spring integration dependency.</li>
  <li>Tell Spring to use annotations to register all of the beans that will be used.</li>
  <li>Create a simple <code>@GET</code> resource with a <code>@Path</code>.</li>
  <li>Build, deploy, verify.</li>
</ol>

<p>Weeeeeeell, if I had simply upgraded an old project from Spring 3 to Spring 4 I would have quickly discovered that RestEasy would stop registering all resources defined in Spring beans. I didn’t do that though. Instead, I created a new project coding totally blind <a href="http://www.theserverside.com/feature/Rod-Johnson-Speaks-of-Method-Deprecation-and-Backwards-Compatability">thinking it would be safe and fun</a> to use Spring 4. When I got a 404 Not Found on my test resource I assumed that I had made a mistake somewhere.</p>

<div class="image-left">
    
    <img src="/img/posts/keyboardsmash.gif" class="shadow" />
    
    
</div>

<p>I spent the next few hours banging my face on my keyboard trying to figure out which important detail I had left out. I swapped out RestEasy’s filter for a servlet, I replaced Spring’s <code>@Component</code> stereotype annotation with Java’s <code>@Resource</code>, I put a dummy JSP in the application to make sure Jetty wasn’t issuing 404 responses to everything. I changed the log level for all RestEasy packages to DEBUG, wrote a servlet that would dump out every end point that RestEasy knew about, and when I got really desperate, I downloaded the source code for RestEasy and started stepping through line by line to figure out why it wasn’t picking up my resource.</p>

<p>It’s amazing that I could run into the problem of RestEasy not registering resources defined with Spring annotations and find so many possible solutions that it could keep me busy for so long! Some of the failed attempts totally led me astray with quirky false positive results too. For example, when I swapped out the RestEasy filter for the equivalent servlet I still received 404 but no HTML was returned in the response, giving me a blank page instead. The original 404 showed a generic Jetty error page and without Chrome Dev Tools open I thought the blank page was actually a 200 response. Alas, it was not.</p>

<p>Eventually I came across <a href="https://issues.jboss.org/browse/RESTEASY-1012">RESTEASY-1012</a> on JBoss’s bug tracker. At the time of this writing, that issue is still unresolved, but it provides a hack that will work until RestEasy’s Spring integration is fixed.</p>

<p>You see this guy?</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="lineno">1</span> <span class="nt">&lt;listener&gt;</span>
<span class="lineno">2</span>   <span class="nt">&lt;listener-class&gt;</span>
<span class="lineno">3</span>     org.jboss.resteasy.plugins.spring.SpringContextLoaderListener
<span class="lineno">4</span>   <span class="nt">&lt;/listener-class&gt;</span>
<span class="lineno">5</span> <span class="nt">&lt;/listener&gt;</span></code></pre></div>

<p>Yeah… so… that guy doesn’t work any more… but it compiles, links, and runs without throwing any exceptions. RestEasy and Spring 4 just stopped talking to each other one day without even bothering with an official divorce.</p>

<p>Fortunately, the JIRA issue provides workaround code. You need to write your own listener and use it in place of <code>SpringContextLoaderListener</code>. It’ll look something like this:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="lineno"> 1</span> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringRestEasyContextLoaderListener</span>
<span class="lineno"> 2</span>         <span class="kd">extends</span> <span class="n">ContextLoaderListener</span> <span class="o">{</span>
<span class="lineno"> 3</span> 
<span class="lineno"> 4</span>     <span class="kd">private</span> <span class="n">SpringContextLoaderSupport</span> <span class="n">springLoader</span>
<span class="lineno"> 5</span>         <span class="o">=</span> <span class="k">new</span> <span class="nf">SpringContextLoaderSupport</span><span class="o">();</span>
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span>     <span class="nd">@Override</span>
<span class="lineno"> 8</span>     <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">customizeContext</span><span class="o">(</span><span class="n">ServletContext</span> <span class="n">sc</span><span class="o">,</span>
<span class="lineno"> 9</span>             <span class="n">ConfigurableWebApplicationContext</span> <span class="n">ctxt</span><span class="o">)</span> <span class="o">{</span>
<span class="lineno">10</span>         <span class="kd">super</span><span class="o">.</span><span class="na">customizeContext</span><span class="o">(</span><span class="n">sc</span><span class="o">,</span> <span class="n">ctxt</span><span class="o">);</span>
<span class="lineno">11</span>         <span class="k">this</span><span class="o">.</span><span class="na">springLoader</span><span class="o">.</span><span class="na">customizeContext</span><span class="o">(</span><span class="n">sc</span><span class="o">,</span> <span class="n">ctxt</span><span class="o">);</span>
<span class="lineno">12</span>     <span class="o">}</span>
<span class="lineno">13</span> <span class="o">}</span></code></pre></div>

<p>The JIRA also explains that the RestEasy-Spring link is severed because Spring 4 removed the deprecated <code>createContextLoader</code> method on <code>ContextLoaderListener</code>. A comparison of the source code for this class in Spring 3.0.5 and Spring 4.0.5 confirmed that Spring did indeed remove the method. So why didn’t RestEasy’s <code>SpringContextLoaderListener</code> just break outright?</p>

<p>It has to do with the <a href="http://docs.oracle.com/javase/1.5.0/docs/api/java/lang/Override.html"><code>@Override</code></a> annotation. Or in this case, the lack of it. RestEasy’s <code>SpringContextLoaderListener</code> extends Spring’s own <code>ContextLoaderListener</code> and overrides the <code>createContextLoader</code>. It has been doing this since the class was originally introduced in resteasy-spring 1.0.0.GA yet the <code>@Override</code> has never existed on that method!</p>

<p>If <code>createContextLoader</code> was marked with <code>@Override</code> then a compiler error would have been presented the moment the resteasy-spring module was built using Spring 4. Since JBoss is probably interested in claiming compatibility with the ever-popular Spring framework, that build probably happened before Spring 4 was even released. Unfortunately, the bug was not identified until after the RestEasy 3.0.6 release.</p>

<p>This is an excellent example of why <code>@Override</code> should be used <a href="http://docs.oracle.com/javase/tutorial/java/IandI/override.html">whenever</a> <a href="http://stackoverflow.com/questions/94361/when-do-you-use-javas-override-annotation-and-why#94411">possible</a>.</p>
</section>
            <p class="signature"> - Erik</p>
        </article>
    </div>
</div>

        </div>
        <footer class="site-footer">
	<p class="text">Copyright © 2015 Technical Rex, Inc. Re-use with attribution encouraged. All other rights reserved.</p>
</footer>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-62666024-3', 'auto');
ga('send', 'pageview');
</script>



    </div>
    <img id="rex" src="/img/rex/rex-main.png"></img>
</body>
</html>
